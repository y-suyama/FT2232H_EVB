import machine
import time

# *************** 温度センサ電圧***********************
# 対応電圧の線形補間関数
# 冷接点補償用温度センサの値を熱電対電圧に変換
def linear_interpolation_t_to_v(temperature):
    # K型熱電対の温度-電圧テーブル
    temp_voltage_table = {
    -50:-1.0,
    -48:-0.96,
    -46:-0.92,
    -44:-0.88,
    -42:-0.84,
    -40:-0.8,
    -38:-0.76,
    -36:-0.72,
    -34:-0.68,
    -32:-0.64,
    -30:-0.6,
    -28:-0.56,
    -26:-0.52,
    -24:-0.48,
    -22:-0.44,
    -20:-0.4,
    -18:-0.36,
    -16:-0.32,
    -14:-0.28,
    -12:-0.24,
    -10:-0.2,
    -8:-0.16,
    -6:-0.12,
    -4:-0.08,
    -2:-0.04,
    0:0.0,
    2:0.08,
    4:0.16,
    6:0.24,
    8:0.32,
    10:0.4,
    12:0.48,
    14:0.56,
    16:0.64,
    18:0.72,
    20:0.8,
    22:0.88,
    24:0.96,
    26:1.04,
    28:1.12,
    30:1.2,
    32:1.28,
    34:1.36,
    36:1.44,
    38:1.52,
    40:1.6,
    42:1.68,
    44:1.76,
    46:1.84,
    48:1.92,
    50:2.0,
    52:2.08,
    54:2.16,
    56:2.24,
    58:2.32,
    60:2.4,
    62:2.48,
    64:2.56,
    66:2.64,
    68:2.72,
    70:2.8,
    72:2.88,
    74:2.96,
    76:3.04,
    78:3.12,
    80:3.2,
    82:3.28,
    84:3.36,
    86:3.44,
    88:3.52,
    90:3.6,
    92:3.68,
    94:3.76,
    96:3.84,
    98:3.92,
    100:4.0,
    102:4.08,
    104:4.16,
    106:4.24,
    108:4.32,
    110:4.4,
    112:4.48,
    114:4.56,
    116:4.64,
    118:4.72,
    120:4.8,
    122:4.88,
    124:4.96,
    126:5.04,
    128:5.12,
    130:5.2,
    132:5.28,
    134:5.36,
    136:5.44,
    138:5.52,
    140:5.6,
    142:5.68,
    144:5.76,
    146:5.84,
    148:5.92,
    150:6.0,
    152:6.08,
    154:6.16,
    156:6.24,
    158:6.32,
    160:6.4,
    162:6.48,
    164:6.56,
    166:6.64,
    168:6.72,
    170:6.8,
    172:6.88,
    174:6.96,
    176:7.04,
    178:7.12,
    180:7.2,
    182:7.28,
    184:7.36,
    186:7.44,
    188:7.52,
    190:7.6,
    192:7.68,
    194:7.76,
    196:7.84,
    198:7.92,
    200:8.0
    }
    keys = list(temp_voltage_table.keys())
    values = list(temp_voltage_table.values())

    try:
        idx = next(i for i, temp in enumerate(keys) if temp > temperature) - 1
    except StopIteration:
        idx = len(keys) - 2 # デフォルトで最後のペアを使用

    temp1, temp2 = keys[idx], keys[idx+1]
    volt1, volt2 = values[idx], values[idx+1]

    return volt1 + (temperature - temp1) * (volt2 - volt1) / (temp2 - temp1)

# *************** 熱電対温度***********************
# 対応温度の線形補間関数
def linear_interpolation_v_to_t(voltage):
    # K型熱電対の電圧-温度テーブル
    temp_voltage_table = {
    -50:-1.0,
    -48:-0.96,
    -46:-0.92,
    -44:-0.88,
    -42:-0.84,
    -40:-0.8,
    -38:-0.76,
    -36:-0.72,
    -34:-0.68,
    -32:-0.64,
    -30:-0.6,
    -28:-0.56,
    -26:-0.52,
    -24:-0.48,
    -22:-0.44,
    -20:-0.4,
    -18:-0.36,
    -16:-0.32,
    -14:-0.28,
    -12:-0.24,
    -10:-0.2,
    -8:-0.16,
    -6:-0.12,
    -4:-0.08,
    -2:-0.04,
    0:0.0,
    2:0.08,
    4:0.16,
    6:0.24,
    8:0.32,
    10:0.4,
    12:0.48,
    14:0.56,
    16:0.64,
    18:0.72,
    20:0.8,
    22:0.88,
    24:0.96,
    26:1.04,
    28:1.12,
    30:1.2,
    32:1.28,
    34:1.36,
    36:1.44,
    38:1.52,
    40:1.6,
    42:1.68,
    44:1.76,
    46:1.84,
    48:1.92,
    50:2.0,
    52:2.08,
    54:2.16,
    56:2.24,
    58:2.32,
    60:2.4,
    62:2.48,
    64:2.56,
    66:2.64,
    68:2.72,
    70:2.8,
    72:2.88,
    74:2.96,
    76:3.04,
    78:3.12,
    80:3.2,
    82:3.28,
    84:3.36,
    86:3.44,
    88:3.52,
    90:3.6,
    92:3.68,
    94:3.76,
    96:3.84,
    98:3.92,
    100:4.0,
    102:4.08,
    104:4.16,
    106:4.24,
    108:4.32,
    110:4.4,
    112:4.48,
    114:4.56,
    116:4.64,
    118:4.72,
    120:4.8,
    122:4.88,
    124:4.96,
    126:5.04,
    128:5.12,
    130:5.2,
    132:5.28,
    134:5.36,
    136:5.44,
    138:5.52,
    140:5.6,
    142:5.68,
    144:5.76,
    146:5.84,
    148:5.92,
    150:6.0,
    152:6.08,
    154:6.16,
    156:6.24,
    158:6.32,
    160:6.4,
    162:6.48,
    164:6.56,
    166:6.64,
    168:6.72,
    170:6.8,
    172:6.88,
    174:6.96,
    176:7.04,
    178:7.12,
    180:7.2,
    182:7.28,
    184:7.36,
    186:7.44,
    188:7.52,
    190:7.6,
    192:7.68,
    194:7.76,
    196:7.84,
    198:7.92,
    200:8.0
    }
    keys = list(temp_voltage_table.keys())
    values = list(temp_voltage_table.values())

    try:
        idx = next(i for i, v in enumerate(values) if v > voltage) - 1
    except StopIteration:
        idx = len(values) - 2 # デフォルトで最後のペアを使用
    temp1, temp2 = keys[idx], keys[idx+1]
    volt1, volt2 = values[idx], values[idx+1]

    return temp1 + (voltage - volt1) * (temp2 - temp1) / (volt2 - volt1)


